/* stylelint-disable declaration-no-important  */
/**
Coursework.
**/

/* Marking page. */
.path-mod-coursework-actions-feedbacks {
    /* Full width container for pdf viewer. */
    .full-width {
        width: 100vw;
        position: relative;
        left: 50%;
        right: 50%;
        margin-left: -50vw;
        margin-right: -50vw;
        max-width: 100vw;
    }

    /* Don't display drawers on marking pages. */
    .drawer-toggles,
    .drawer {
        display: none !important;
    }
    #page.drawers.show-drawer-left,
    #page.drawers.show-drawer-right {
        margin-left: 0;
        margin-right: 0;
    }

    /* PDF viewer. */
    #pdf-container {
        max-width: 850px !important;
        #pdf-viewer {
            overflow: scroll;
            margin-top: 1rem !important;
            text-align: center;
        }
        canvas {
            display: block;
            width: 100%;
        }

        /* Submission metadata. */
        .mod-coursework-submission {
            display: flex;
            align-items: flex-start;
            .mod-coursework-submission-metadata {
                margin-left: auto;
            }
        }
    }

    /* Normalise number input fields. */
    input[type=number] {
        field-sizing: content; /* stylelint-disable-line */
        min-width: 4rem;
        text-align: right;
    }

    .showmarkerdesc,
    .showstudentdesc {
        display: block;
        padding: 1rem;
        label {
            display: block;
            font-size: small;
        }
    }

}

.cm-type-coursework,
.path-mod-coursework {

    /* Rubric and advanced grading forms. */
    #rubric-rubric.preview,
    #advancedgrading-criteria {
        display: block;
        width: 100%;

        &,
        & tbody,
        & tr,
        & td,
        table {
            /* Remove default table spacing/border and force block display */
            display: block;
            margin: 0 !important;
            padding: 0 .1rem !important;
            border: none !important;
            width: 100% !important;
            max-width: 100%;
            text-align: left;
        }

        /* Remove bg colour for even/odd td. */
        .criterion.even,
        .criterion.even td {
            background-color: transparent;
        }

        /* Show form labels. */
        .remark label {
            margin-top: 1rem;
            &.hidden {
                display: block !important;
                margin-top: 0;
            }
        }

        /* Criteria title - faux headings. */
        .description,
        .criterionshortname {
            font-weight: bold;
            font-size: 1.2rem;
            display: block;
            padding-top: 2rem !important;

            .review-marks {
                font-size: 1rem;
                font-weight: normal;
            }
        }

        /* Small for criteria description. */
        .criteriondescription,
        .criteriondescriptionmarkers {
            font-size: small;
            width: auto;
        }

        /* Radio input, definition, and score. */
        .level-wrapper {
            display: flex;
            flex-direction: row;
            align-items: start;
            width: 100%;
            padding: .5rem;

            .radio {
                display: block !important;
                transform: scale(1.5);
                margin-right: 0.5rem;
                margin-top: 0.2rem;
            }

            .definition {
                padding: 0 1rem;
            }

            .score {
                margin: 0;
                margin-left: auto;
                padding: 0.25em 0.6em !important;
                text-wrap: nowrap; /* stylelint-disable-line */
                font-style: normal;
                font-size: small;
                color: var(--dark);
                max-height: 2rem;
                border-radius: 10rem;
            }

            /* Rubric selected level styles. */
            &:has(.radio input[type="radio"]:checked) {
                background-color: var(--light);

                .score {
                    /* Score rounded pill success styles. */
                    background-color: var(--success);
                    color: white;
                }

                .definition {
                    font-weight: bold;
                }
            }
            &:has(.radio) {
                &:hover {
                    background-color: var(--light);
                    cursor: pointer;
                }
            }
        }

        /* Comment area. */
        textarea,
        .markingguideremark {
            width: 100%;
            box-sizing: border-box;
        }

        /* Reduce the textarea height and add padding */
        textarea {
            padding: 0.5rem;
            min-height: 4rem;
            field-sizing: content; /* stylelint-disable-line */
        }

        /* Add frequently use comments button. */
        .commentchooser {
            display: block;
            font-size: small;
            margin: .5rem 0;
        }
    }

    /* Marking guide (advanced grading, but not rubric). */
    .gradingform_guide table#advancedgrading-criteria {
        td.remark {
            display: inline-block;
            vertical-align: top;
            width: 75% !important;
            box-sizing: border-box;
        }

        td.score {
            display: inline-block;
            width: 25% !important;
            text-align: right;
            input {
                margin-left: auto;
            }
        }
    }

    /* Hide advanced marking form header. */
    #coursework-markingform {
        #id_advancedgrading_label,
        .gradingform_guide-description {
            display: none !important;
        }
    }

    /* Marking form and student feedback. */
    #coursework-markingform,
    .coursework-feedback {
        /* Full width cols. */
        div.col-md-3,
        div.col-md-9 {
            max-width: 100%;
            flex: 0 0 100%;
        }
        .col-form-label {
            font-weight: bold;
        }

        /* Grading tables. */
        .gradingform_guide,
        .gradingform_rubric {
            display: block;
            width: 100%;

            .criterion.even,
            .criterion.even td {
                background-color: transparent;
            }
            .criteria {
                height: auto;
            }
            label {
                font-weight: normal;
            }
            .score {
                text-align: right;
            }
        }
    }
}

.path-mod-coursework {
    /* Hide activity header - date and description displayed differently. */
    .activity-header {
        display: none !important;
    }

    /* SHAME - not able to add btn-block in php. */
    #coursework-finalise-submission .btn {
        display: block !important;
        width: 100%;
    }

    /* Plagiarism in table submissions col. */
    .mod-coursework-submissions-submission-col .core_plagiarism_links {
        display: block;
        padding: .5rem;
        margin-top: .5rem;
        background-color: var(--light);

        .tii_links_container {
            padding: 0;

            /* Hide icon. */
            img[src*="turnitin-icon"] {
                display: none;
            }

            .turnitin_status {
                font-size: small;
            }

            /* Resubmit - style as link. */
            [id^=pp_resubmit] {
                color: var(--primary);
                &:hover {
                    text-decoration: underline;
                }
            }
        }
    }

    /* Actions menu dropdown dividers. */
    .mod-coursework-submissions-action-col .dropdown-menu {
        /* Hide any hanging dividers. */
        .dropdown-divider:last-of-type,
        .dropdown-divider + .dropdown-divider {
            display: none;
        }
    }
    .coursework-feedback {
        /* General bubble styles (same as before, but added a top-left class for clarity) */
        .chat-bubble-bordered {
            position: relative;
            background-color: white;
            border: 2px solid var(--dark);
            box-shadow: .3em .3em 0 0 var(--dark);
            padding: 1rem;
            margin-top: 25px; /* Added space at the top for the arrow */
        }

        /* Specific styles for the top-left arrow */
        .chat-bubble-bordered::before {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-left: 1rem solid transparent;  /* Base of the outer triangle */
            border-right: 1rem solid transparent; /* Base of the outer triangle */
            border-bottom: 1.1rem solid var(--dark); /* Color of the border, pointing up */
            top: -18px; /* Position above the bubble, accounting for border and triangle height */
            left: 1rem; /* Horizontal position from the left */
            z-index: 1;
        }

        .chat-bubble-bordered::after {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-left: 1rem solid transparent;  /* Slightly smaller base for inner triangle */
            border-right: 1rem solid transparent; /* Slightly smaller base for inner triangle */
            border-bottom: 1.1rem solid white; /* Match the body background to "cut out" */
            top: -15px; /* Position relative to the outer triangle */
            left: 1rem; /* Horizontal position, slightly offset to match outer */
            z-index: 2;
        }
    }
    &.path-mod-coursework-actions-feedbacks #id_removefeedbackbutton {
        color: var(--white);
        background-color: var(--danger);
        border-color: var(--danger);
    }

    .container + .container > .alert {
        /* Ensure there's space above notifications. */
        margin-top: 1em;
    }
}

/* Advanced pdf stuff. */
#page-mod-coursework-actions-feedbacks-viewpdf #page {
    padding: 0;

    #printButton,
    #downloadButton,
    #secondaryOpenFile,
    #secondaryPrint,
    #secondaryDownload,
    #presentationMode,
    #viewBookmark,
    #viewBookmarkSeparator,
    #spreadModeButtons {
        display: none;
    }
}