define("mod_coursework/turnitin_similarity_fetcher",["exports","../../../../lib/amd/src/ajax","core/str","core/log"],(function(_exports,_ajax,_str,_log){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}let courseworkId;
/**
   * Javascript module for handling fetching of similarity data from TII after page load.
   *
   * @module      mod_coursework/turnitin_similarity_fetcher
   * @copyright   2025 UCL
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=_interopRequireDefault(_ajax),_log=_interopRequireDefault(_log);const processTurnitin=function(fn){let timerId,delay=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return function(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];clearTimeout(timerId),timerId=setTimeout((()=>fn.apply(this,args)),delay)}}((async()=>{const submissionIds=[...document.querySelectorAll(".mod-coursework-plagiarism-tii-links")].filter((el=>"false"===el.dataset.tiiLoaded)).filter((el=>{const{top:top,bottom:bottom,left:left,right:right}=el.getBoundingClientRect();return top>=0&&bottom<=window.innerHeight&&left>=0&&right<=window.innerWidth})).map((elem=>parseInt(elem.closest(".mod-coursework-submissions-submission-col").dataset.submissionId)));if(submissionIds.length){const WSResult=await _ajax.default.call([{methodname:"mod_coursework_get_turnitin_similarity_links",args:{courseworkid:courseworkId,submissionids:submissionIds}}])[0],tiiEmptyString=await(0,_str.getString)("turnitinnoreport","coursework");WSResult.success?WSResult.result.forEach((submission=>{submission.files.forEach((file=>{const el=document.getElementById("mod-coursework-plagiarism-tii-links-"+file.fileid);el?(el.innerHTML=file.linkshtml,""===el.innerHTML&&(el.innerHTML="<small>".concat(tiiEmptyString,"</small>")),el.dataset.tiiLoaded="true"):_log.default.debug("Element not found #mod-coursework-plagiarism-tii-links-"+file.fileid)}))})):(_log.default.debug("Error getting Turnitin links for submissions "+submissionIds.join(",")+": "+WSResult.errorcode+" | "+WSResult.message),submissionIds.forEach((id=>{document.querySelectorAll('.mod-coursework-submissions-submission-col[data-submission-id="'.concat(id,'"]')+".mod-coursework-plagiarism-tii-links").forEach((el=>{el.innerHTML="<small>".concat(tiiEmptyString,"</small>"),el.dataset.tiiLoaded="true"}))})))}}),100);_exports.init=courseworkid=>{courseworkId=courseworkid,window.addEventListener("scrollend",processTurnitin,{passive:!0}),processTurnitin()}}));

//# sourceMappingURL=turnitin_similarity_fetcher.min.js.map