define("mod_coursework/coursework",["jquery","core/str","core/notification"],(function($,str,notification){return{init:function(){var table_obj_list=[],tableobject=0;function isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}$(document).ready((function(){var base_url=window.location.origin+"/mod/coursework/datatables/js/";function initDatatable(){$(".datatabletest").each((function(){var fullloaded=$(this).hasClass("full-loaded");table_obj_list[$(this).attr("id")]=$(this).DataTable({order:[],stateSave:!0,language:{searchPanes:{collapse:{0:$("#search_pane_button").val()||"Filter",_:($("#search_pane_button").val()||"Filter")+" (%d)"}}},buttons:[],dom:"Blfrtip",columnDefs:[{searchPanes:{show:!1},targets:["studentname","addition-multiple-button"],bSortable:!1},{searchPanes:{show:!1},targets:["lastname_cell","firstname_cell","tableheadpersonaldeadline","tableheaddate","tableheadfilename","tableheadplagiarismalert","plagiarism","agreedgrade","feedbackandgrading","provisionalgrade","tableheadmoderationagreement"]},{searchPanes:{show:!0,header:$("#search_pane_group").val()||"Group"},targets:"tableheadgroups"},{searchPanes:{show:!0,header:$("#search_pane_status").val()||"Status",getFullText:!0},targets:"tableheadstatus"},{searchPanes:{show:!0,header:$("#search_pane_firstname").val()||"First Name Initial"},targets:"firstname_letter_cell"},{searchPanes:{show:!0,header:$("#search_pane_lastname").val()||"Last Name Initial"},targets:"lastname_letter_cell"},{visible:!1,targets:["lastname_letter_cell","firstname_letter_cell","lastname_cell","firstname_cell"]}],select:{style:"multi",selector:".select-checkbox"},stateSaveParams:function(settings,data){data.columns=[]}}),fullloaded||function(tableid){var tableelement=$("#"+tableid),wrapperelement=tableelement.parent(".dataTables_wrapper"),paginationelement=wrapperelement.find(".dataTables_paginate");tableobject=table_obj_list[tableid];var submissionswrapper=tableelement.parent(".dataTables_wrapper");wrapperelement.find(".dataTables_paginate, .dataTables_info, .dataTables_length, .dataTables_filter").css("visibility","hidden"),wrapperelement.find("thead, .dt-button").each((function(){var me=$(this);me.css("pointer-events","none"),me.hasClass("dt-button")&&me.find("span").html(" "+me.find("span").html())})),window.console.log(submissionswrapper),str.get_string("loadingpagination","mod_coursework").done((function(message){$('<div id="datatable_top_loading_message" class="text-center submission-loading"><i class="fa fa-spinner fa-spin"></i> '+message+"</div>").insertBefore(submissionswrapper),$('<div class="text-center pagination-loading"><i class="fa fa-spinner fa-spin"></i> '+message+"</div>").insertAfter(paginationelement),$('<i class="fa fa-spinner fa-spin pagination-loading"></i>').insertBefore(wrapperelement.find(".dt-button > span"))})).catch(notification.exception);var params={group:tableelement.attr("group"),perpage:tableelement.attr("perpage"),sortby:tableelement.attr("sortby"),sorthow:tableelement.attr("sorthow"),firstnamealpha:tableelement.attr("firstnamealpha"),lastnamealpha:tableelement.attr("lastnamealpha"),groupnamealpha:tableelement.attr("groupnamealpha"),substatus:tableelement.attr("substatus"),unallocated:tableelement.attr("unallocated"),courseworkid:tableelement.attr("courseworkid")};$.ajax({url:"/mod/coursework/actions/ajax/datatable/grading.php",type:"POST",data:params}).done((function(response){$("#datatable_top_loading_message").remove(),tableobject.rows.add($(response)).draw(!1),wrapperelement.find(".submission-loading").remove()})).fail((function(){})).always((function(){wrapperelement.find(".pagination-loading").remove(),wrapperelement.find(".submission-loading").remove(),wrapperelement.find("thead, .dt-button").css("pointer-events","auto"),wrapperelement.find(".dataTables_paginate, .dataTables_info, .dataTables_length, .dataTables_filter").css("visibility","visible")}))}($(this).attr("id"))}))}if(require.config({paths:{"datatables.net":base_url+"jquery.datatables","datatables.searchpanes":base_url+"datatables.searchpanes","datatables.buttons":base_url+"datatables.buttons","datatables.select":base_url+"datatables.select","datatables.responsive":base_url+"datatables.responsive.min"}}),require(["datatables.net"],(function(DataTable){$.fn.dataTable||($.fn.dataTable=DataTable),$.fn.DataTable=DataTable,$.fn.DataTableSettings=DataTable.settings,$.fn.dataTableExt=DataTable.ext,DataTable.$=$,$.fn.DataTable=function(opts){return $(this).dataTable(opts).api()},$.fn.dataTable.Api.register("row().show()",(function(){var page_info=this.table().page.info(),new_row_index=this.index(),row_position=this.table().rows({search:"applied"})[0].indexOf(new_row_index);if(row_position>=page_info.start&&row_position<page_info.end||row_position<0)return this;var page_to_display=Math.floor(row_position/this.table().page.len());return this.table().page(page_to_display),this})),require(["datatables.searchpanes","datatables.select","datatables.buttons","datatables.responsive"],(function(){isMobileDevice()&&$(window).width()<768?(initDatatable(),$(".datatabletest").on("order.dt",(function(){$(".submissionrowmulti").removeClass("shown")}))):initDatatable()}))})),isMobileDevice()&&$(window).width()<768)var table=$(".datatabletest tbody").on("click","td.details-control",(function(){var tr=$(this).closest("tr"),table_id="assessorfeedbacktable_"+tr.attr("id").replace("allocatable_","");if($(tr).next("tr.row_assessors").length>0)$(tr).next("tr.row_assessors").remove();else{const oldTable=$("#"+table_id),newRow=$('<tr class = "submissionrowmultisub row_assessors"><td class="assessors" colspan = "11"></td></tr>');oldTable.addClass("assessors_expanded").css("width","95%").appendTo(newRow.find("td"))}$(tr).toggleClass("shown")}));else $(".datatabletest tbody").on("click","td.details-control",(function(){var tr=$(this).closest("tr"),table_key=$(this).closest(".datatabletest").attr("id"),table=table_obj_list[table_key];if(table){var row=table.row(tr),row_id=tr.attr("id").replace("allocatable_","");const oldTable=$("#"+("assessorfeedbacktable_"+row_id)),subRow=$("#sub-row-"+tr.data("allocatable"));if(oldTable.length)if(0===subRow.length){const newRow=$('<tr class = "submissionrowmultisub" id="sub-row-'+tr.data("allocatable")+'"><td class="assessors" colspan = "11"></td></tr>');oldTable.addClass("assessors_expanded").css("width","95%").appendTo(newRow.find("td")),oldTable.show(),row.child(newRow).show(),tr.addClass("shown")}else"none"===subRow.css("display")?(subRow.show(),tr.addClass("shown")):(tr.removeClass("shown"),subRow.hide());else"none"===subRow.css("display")?(subRow.show(),tr.addClass("shown")):(subRow.hide(),tr.removeClass("shown"))}}));$(".datatabletest").on("click",".splitter-firstname, .splitter-lastname, .splitter-email",(function(event){event.preventDefault();var node=$(event.target),currentsort="asc",sortby="desc";node.hasClass("sorting_asc")||(currentsort="desc",sortby="asc");var table_id=$(this).closest(".datatabletest").attr("id");table=table_obj_list[table_id];var headerclass=$(this).hasClass("splitter-firstname")?"firstname_cell":"lastname_cell";headerclass=$(this).hasClass("splitter-email")?"email_cell":headerclass,window.console.log(headerclass);var sortColumn=table.column("."+headerclass).index();table.order([sortColumn,sortby]).draw(),node.addClass("sorting_"+sortby).removeClass("sorting sorting_"+currentsort),node.parent().removeClass("sorting sorting_asc sorting_desc"),node.siblings().removeClass("sorting_asc sorting_desc").addClass("sorting")}))}))}}}));

//# sourceMappingURL=coursework.min.js.map