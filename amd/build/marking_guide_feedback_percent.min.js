define("mod_coursework/marking_guide_feedback_percent",["exports","core/str","core/ajax"],(function(_exports,_str,_ajax){var obj;
/**
   * Javascript module for marking guide feedback form percentages helper.
   *
   * @module      mod_coursework/marking_guide_feedback_percent
   * @copyright   2026 UCL
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=(obj=_ajax)&&obj.__esModule?obj:{default:obj};let usingPercentGrades;const getFieldName=(criterionNumber,isPercent)=>"advancedgrading-criteria-".concat(criterionNumber,"-")+(isPercent?"percent":"score"),handleCheckBoxClick=async()=>{const checkBox=event.target;usingPercentGrades=checkBox.checked;document.querySelectorAll("table#advancedgrading-criteria .input-percent").forEach((elem=>{usingPercentGrades?elem.removeAttribute("readonly"):elem.setAttribute("readonly",!0)}));document.querySelectorAll("table#advancedgrading-criteria input:not(.input-percent)").forEach((elem=>{usingPercentGrades?elem.setAttribute("readonly",!0):elem.removeAttribute("readonly")}));const request={methodname:"core_user_update_user_preferences",args:{preferences:[{type:"coursework_guide_enter_percent_grades",value:checkBox.checked?1:0}]}};await _ajax.default.call([request])[0]};_exports.init=initialPreferenceValue=>{usingPercentGrades=initialPreferenceValue;const checkBox=document.querySelector('input[data-action="coursework-set-pref-grades-as-percent"]');document.getElementById("advancedgrading-criteria")&&checkBox&&checkBox.addEventListener("input",handleCheckBoxClick),(async()=>{const markPercentString=await(0,_str.getString)("markpercent","coursework");document.querySelectorAll("div#guide-advancedgrading tr.criterion td.score").forEach((tableCell=>{var _scoreInputElem$name$;const scoreInputElem=tableCell.querySelector("input"),criterionNumber=null!==(_scoreInputElem$name$=scoreInputElem.name.match(/advancedgrading\[criteria]\[(\d+)]\[score]/)[1])&&void 0!==_scoreInputElem$name$?_scoreInputElem$name$:null,newFieldName=getFieldName(criterionNumber,!0),scoreOutOf=parseInt(scoreInputElem.max);scoreInputElem.setAttribute("data-criterion-number",criterionNumber),usingPercentGrades&&scoreInputElem.setAttribute("readonly","true"),scoreInputElem.addEventListener("input",handleScoreChangeEvent);const inp=document.createElement("input");inp.name=newFieldName,inp.classList.add("form-control"),inp.classList.add("input-percent","mb-2"),inp.id=newFieldName,inp.setAttribute("data-criterion-number",criterionNumber),inp.setAttribute("type","text"),inp.setAttribute("inputmode","decimal"),inp.setAttribute("size",4),inp.setAttribute("min",0),inp.setAttribute("max",100),inp.setAttribute("step",1/Math.pow(10,2)),usingPercentGrades||inp.setAttribute("readonly",!0),tableCell.insertBefore(inp,tableCell.firstChild),inp.addEventListener("input",handlePercentChangeEvent),inp.addEventListener("keypress",preventInvalidNumber);const label=document.createElement("label");label.setAttribute("for",newFieldName),label.classList.add("text-right"),label.textContent=markPercentString,tableCell.insertBefore(label,tableCell.firstChild),""!==scoreInputElem.value&&setPercentageFromScore(criterionNumber,Number(scoreInputElem.value),scoreOutOf)}))})()};const setPercentageFromScore=(criterionNumber,scoreValue,scoreOutOf)=>{const percentElem=document.getElementById(getFieldName(criterionNumber,!0));var value;""!==scoreValue?percentElem.value=(value=scoreValue/scoreOutOf*100,0===Math.abs(value.toFixed(2)-Math.floor(value))?value.toFixed(0):value.toFixed(2)):percentElem.value=""},setScoreFromPercent=(criterionNumber,percentValue)=>{const scoreInputElem=document.getElementById(getFieldName(criterionNumber,!1));scoreInputElem.value=""===percentValue?"":(Number(scoreInputElem.max)*percentValue/100).toFixed(2),scoreInputElem.classList.remove("invalid-value")},preventInvalidNumber=event=>{if(!/[0-9.]/.test(event.key))return void event.preventDefault();const maxLength=event.target.value.includes(".")?5:4;!(event.target.selectionStart!==event.target.selectionEnd)&&event.target.value.length>=maxLength&&"Backspace"!==event.key&&"Delete"!==event.key&&event.preventDefault()},handleScoreChangeEvent=event=>{const criterionNumber=Number(event.target.getAttribute("data-criterion-number")),scoreOutOf=Number(event.target.max);if(""===event.target.value)return void setPercentageFromScore(criterionNumber,"");const newValue=Math.max(Math.min(event.target.value,parseInt(event.target.max)),0);newValue!==Number(event.target.value)?event.target.classList.add("invalid-value"):event.target.classList.remove("invalid-value"),setPercentageFromScore(criterionNumber,newValue,scoreOutOf)},handlePercentChangeEvent=event=>{const criterionNumber=Number(event.target.getAttribute("data-criterion-number"));if(""===event.target.value)return void setScoreFromPercent(criterionNumber,"");const newValue=Math.max(Math.min(Number(event.target.value),100),0);newValue!==Number(event.target.value)?event.target.classList.add("invalid-value"):event.target.classList.remove("invalid-value"),setScoreFromPercent(criterionNumber,newValue)}}));

//# sourceMappingURL=marking_guide_feedback_percent.min.js.map