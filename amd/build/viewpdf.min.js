define("mod_coursework/viewpdf",["exports","core/ajax","core/prefetch","core/str","core/toast"],(function(_exports,_ajax,_prefetch,_str,_toast){var obj;
/**
   * Javascript module for handling personal extension modal.
   *
   * @module      mod_coursework/viewpdf
   * @copyright   2025 UCL
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_ajax=(obj=_ajax)&&obj.__esModule?obj:{default:obj};var controller={saveannotations:async function(){const pdfdata=await window.pdfcontroller.getpdfdata(),blob=new Blob([pdfdata],{type:"application/pdf"}),data=new FormData;data.append("annotations",blob,"annotated.pdf"),data.append("submissionid",controller.currentfiledataset.submissionid),data.append("fileid",controller.currentfiledataset.fileid),data.append("filename",controller.currentfiledataset.filename);const response=await fetch("../../actions/uploadannotatedsubmissionajax.php",{method:"POST",body:data}),result=await response.json();controller.currentfiledataset.annotatedfileurl=result.url,controller.currentfiledataset.annotatedfileid=result.fileid,(0,_toast.add)((0,_str.getString)("annotationssaved","mod_coursework"),{type:"success"})},loadpdf:async function(dataset){var url=dataset.href;return dataset.annotatedfileurl&&(url=dataset.annotatedfileurl),controller.currentfiledataset=dataset,window.pdfcontroller.loadpdf(url)},clearannotations:async function(){_ajax.default.call([{methodname:"mod_coursework_clearannotations",args:{submissionid:controller.currentfiledataset.submissionid,fileid:controller.currentfiledataset.annotatedfileid}}])[0].then((()=>{controller.currentfiledataset.annotatedfileurl="",controller.currentfiledataset.annotatedfileid="",controller.loadpdf(controller.currentfiledataset),(0,_toast.add)((0,_str.getString)("annotationscleared","mod_coursework"),{type:"success"})})).catch((error=>{(0,_toast.add)(error,{type:"error"})}))}};_exports.init=async()=>{(0,_prefetch.prefetchStrings)("mod_coursework",["annotationssaved","annotationscleared"]);let viewfilebuttons=document.querySelectorAll('[data-action="modcoursework_viewfile"]');viewfilebuttons.forEach((node=>{node.addEventListener("click",(async event=>{await controller.loadpdf(event.target.dataset).promise}))})),viewfilebuttons[0]&&await controller.loadpdf(viewfilebuttons[0].dataset).promise,document.querySelector('[data-action="modcoursework_saveannotations"]').addEventListener("click",(async()=>{await controller.saveannotations().promise})),document.querySelector('[data-action="modcoursework_clearannotations"]').addEventListener("click",(async()=>{await controller.clearannotations().promise}))}}));

//# sourceMappingURL=viewpdf.min.js.map