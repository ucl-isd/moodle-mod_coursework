{"version":3,"file":"marking_guide.min.js","sources":["../src/marking_guide.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n//\n\n/**\n * Marking guide enhancements for mod_coursework.\n *\n * @module     mod_coursework/marking_guide\n * @copyright  2026 UCL\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport * as FeedbackPercent from \"mod_coursework/marking_guide_feedback_percent\";\n\nconst MAX_INPUT_LENGTH = 5;\n\nconst preventInvalidNumber = (event) => {\n    // Field will allow user to enter e for scientific notation - stop that.\n    if (!/[0-9.]/.test(event.key)) {\n        event.preventDefault();\n        return;\n    }\n    if (\n        event.target.value.length >= MAX_INPUT_LENGTH\n        && event.key !== 'Backspace'\n        && event.key !== 'Delete'\n    ) {\n        event.preventDefault();\n    }\n};\n\n/**\n * Set up the marking guide score field enhancements.\n *\n * @param {String} markLabelText The localized string for \"Mark\" passed from Mustache.\n */\nconst setUpUI = (markLabelText) => {\n    const rootElement = document.getElementById('coursework-markingform');\n    if (!rootElement) {\n        return;\n    }\n\n    const scoreCells = rootElement.querySelectorAll('td.score');\n\n    scoreCells.forEach(cell => {\n        const scoreInput = cell.querySelector('input');\n        const maxScoreDiv = cell.querySelector('div');\n\n        if (scoreInput && maxScoreDiv) {\n            // Extract only numbers/decimals from the max score text.\n            const maxScore = maxScoreDiv.textContent.replace(/[^0-9.]/g, '');\n\n            // 1. Enhance the input field.\n            scoreInput.setAttribute('required', 'required');\n            scoreInput.setAttribute('type', 'number');\n            scoreInput.setAttribute('min', '0');\n            scoreInput.setAttribute('step', 'any');\n\n            if (maxScore) {\n                scoreInput.setAttribute('max', maxScore);\n            }\n\n            // 2. Create and insert the Label.\n            const scoreLabel = document.createElement('label');\n            scoreLabel.textContent = `${markLabelText} (0â€“${maxScore})`;\n\n            if (scoreInput.id) {\n                scoreLabel.setAttribute('for', scoreInput.id);\n            }\n\n            // Insert at the top of the cell.\n            cell.insertBefore(scoreLabel, cell.firstChild);\n\n            // 3. Clean up the old overhanging div.\n            maxScoreDiv.remove();\n        }\n\n        scoreInput.addEventListener('keypress', preventInvalidNumber);\n    });\n};\n\n/**\n * Initialize the marking guide score field enhancements.\n *\n * @param {String} markLabelText The localized string for \"Mark\" passed from Mustache.\n * @param {boolean} enterPercentGrades whether user want to enter grades as percentages (user preference).\n */\nexport const init = (markLabelText, enterPercentGrades) => {\n    setUpUI(markLabelText);\n    // Once the new fields are added, can initialise the percentage field JS (which depends on them).\n    FeedbackPercent.init(enterPercentGrades);\n};\n"],"names":["preventInvalidNumber","event","test","key","target","value","length","preventDefault","markLabelText","enterPercentGrades","rootElement","document","getElementById","querySelectorAll","forEach","cell","scoreInput","querySelector","maxScoreDiv","maxScore","textContent","replace","setAttribute","scoreLabel","createElement","id","insertBefore","firstChild","remove","addEventListener","setUpUI","FeedbackPercent","init"],"mappings":";;;;;;;6BA4BMA,qBAAwBC,QAErB,SAASC,KAAKD,MAAME,KAKrBF,MAAMG,OAAOC,MAAMC,QATF,GAUA,cAAdL,MAAME,KACQ,WAAdF,MAAME,KAETF,MAAMM,iBARNN,MAAMM,gCAoEM,CAACC,cAAeC,sBAnDnBD,CAAAA,sBACPE,YAAcC,SAASC,eAAe,8BACvCF,mBAIcA,YAAYG,iBAAiB,YAErCC,SAAQC,aACTC,WAAaD,KAAKE,cAAc,SAChCC,YAAcH,KAAKE,cAAc,UAEnCD,YAAcE,YAAa,OAErBC,SAAWD,YAAYE,YAAYC,QAAQ,WAAY,IAG7DL,WAAWM,aAAa,WAAY,YACpCN,WAAWM,aAAa,OAAQ,UAChCN,WAAWM,aAAa,MAAO,KAC/BN,WAAWM,aAAa,OAAQ,OAE5BH,UACAH,WAAWM,aAAa,MAAOH,gBAI7BI,WAAaZ,SAASa,cAAc,SAC1CD,WAAWH,sBAAiBZ,6BAAoBW,cAE5CH,WAAWS,IACXF,WAAWD,aAAa,MAAON,WAAWS,IAI9CV,KAAKW,aAAaH,WAAYR,KAAKY,YAGnCT,YAAYU,SAGhBZ,WAAWa,iBAAiB,WAAY7B,0BAW5C8B,CAAQtB,eAERuB,gBAAgBC,KAAKvB"}