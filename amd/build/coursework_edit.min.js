define("mod_coursework/coursework_edit",["jquery","core/notification","core/modal","core/str"],(function($,Notification,Modal,str){return{init:function(){var now=new Date,extension_form_change=!1;$(document).ready((function(){var datatables_lang_messages=JSON.parse($("#datatables_lang_messages").attr("data-lang"));function change__status_extension_submit_button(status){$("#extension-submit").prop("disabled",status)}function save_extension_form_data(){extension_form_change=!1}$(".datatabletest").on("click",".edit_personal_deadline",(function(e){e.preventDefault();var parent=$(this).closest(".personal_deadline_cell");parent.children(".show_personal_dealine").addClass("display-none");var change_form=parent.children(".show_edit_personal_dealine"),data_get=$(this).attr("data-get"),data_time=$(this).attr("data-time-iso-8601");if(1===change_form.html().length){var form='<input type="datetime-local" step="300" class="input-personal-deadline" value="'+data_time+'">';form+='<div class="personal_deadline_button"><a href="/" class="approve-personal-deadline" data-get=',form+=data_get,form+='><i class="fa fa-check" aria-hidden="true"></i></a>',form+='<a href="/" class="cancel-personal-deadline"><i class="fa fa-times" aria-hidden="true"></i></a></div>',$(change_form).html(form)}$(change_form).removeClass("display-none")})),$(".datatabletest").on("click",".cancel-personal-deadline",(function(e){e.preventDefault(),$(this).closest(".show_edit_personal_dealine").addClass("display-none"),$(this).closest(".personal_deadline_cell").children(".show_personal_dealine").removeClass("display-none")})),$(".datatabletest").on("click",".approve-personal-deadline",(function(e){e.preventDefault();var deadline=$(this),data_get=$(deadline).attr("data-get"),value=$(deadline).closest(".show_edit_personal_dealine").children(".input-personal-deadline").val();new Date(value)<=Date.parse(now)&&Modal.create({title:datatables_lang_messages.notification_info,body:datatables_lang_messages.alert_validate_deadline.replace(/\_/g," "),show:!0,removeOnClose:!0});var url=datatables_lang_messages.url_root+"/mod/coursework/actions/personal_deadline.php",param=JSON.parse(data_get);param.personal_deadline_time=value,$.ajax({type:"POST",url:url,data:param,beforeSend:function(){$("html, body").css("cursor","wait"),$(self).prev("img").css("visibility","visible")},success:function(response,table_obj_list){$("html, body").css("cursor","auto");var data_response=JSON.parse(response);if(1===data_response.error)Modal.create({title:datatables_lang_messages.notification_info,body:data_response.message,show:!0,removeOnClose:!0});else{var parent=$(deadline).closest(".personal_deadline_cell");$(parent).attr("data-order",data_response.timestamp),table_obj_list[Object.keys(table_obj_list)[0]].row("#"+$(parent).closest("tr").attr("id")).invalidate(),$(parent).children(".show_personal_dealine").children(".content_personal_deadline").html(data_response.time),$(parent).children(".show_edit_personal_dealine").addClass("display-none"),$(parent).children(".show_personal_dealine").removeClass("display-none"),Modal.create({title:datatables_lang_messages.notification_info,body:datatables_lang_messages.alert_personaldeadline_save_successful.replace(/\_/g," "),show:!0,removeOnClose:!0})}},error:function(){$("html, body").css("cursor","auto")},complete:function(){$("html, body").css("cursor","auto")}})})),$(".coursework-actions").on("click",".new_deadline_extension",(function(e){e.preventDefault(),function(data_name,data_params,data_time,current_rowid){var title="New extension for "+data_name;if($("#extension-modal-title").html(title),$("#form-extension").find("input[type=hidden]").val(""),$("#form-extension").find("textarea").val(""),"1"==data_time.is_have_deadline){var url=datatables_lang_messages.url_root;$.ajax({type:"GET",url:url+"/mod/coursework/actions/ajax/deadline_extension/new.php",data:data_params,beforeSend:function(){change__status_extension_submit_button(!0),$("html, body").css("cursor","wait"),$(".modal-footer").children("img").css("visibility","visible")},success:function(response){$("html, body").css("cursor","auto"),$(".modal-footer").children("img").css("visibility","hidden");var data_response=JSON.parse(response);$("#extension-time-content").html(data_response.data.time_content),document.getElementById("extension-extend-deadline").value=data_response.data.time_iso_8601.slice(0,16),save_extension_form_data()},error:function(){$("html, body").css("cursor","auto")},complete:function(){$("html, body").css("cursor","auto")}})}else save_extension_form_data();$("#extension-reason-select").val(""),$("#extension-allocatabletype").val(data_params.allocatabletype),$("#extension-allocatableid").val(data_params.allocatableid),$("#extension-courseworkid").val(data_params.courseworkid),$("#extension-submissionid").val(data_params.submissionid),$("#extension-name").val(data_name),$("#button-id").val(current_rowid),$("#id_extra_information").prop("disabled",!1),$("#extension-extend-deadline").prop("disabled",!1),$("#extension-reason-select").prop("disabled",!1)}($(this).attr("data-name"),JSON.parse($(this).attr("data-params")),JSON.parse($(this).attr("data-time")),$(this).closest("tr").attr("id")),$("#modal-ajax").modal("show")})),$(".coursework-actions").on("click",".edit_deadline_extension",(function(e){e.preventDefault(),function(data_name,data_params,data_time,current_rowid){var title="Editing the extension for "+data_name,time_content="Default deadline: "+data_time.time_content;$("#extension-modal-title").html(title),$("#form-extension").find("input[type=hidden]").val(""),$("#form-extension").find("textarea").val(""),$("#button-id").val(current_rowid),$("#extension-submissionid").val(data_params.submissionid),$("#extension-name").val(data_name),data_params.requesttype="edit";var url=datatables_lang_messages.url_root;$.ajax({type:"GET",url:url+"/mod/coursework/actions/ajax/deadline_extension/edit.php",data:data_params,beforeSend:function(){change__status_extension_submit_button(!0),$("html, body").css("cursor","wait"),$(".modal-footer").children("img").css("visibility","visible")},success:function(response){var data_response=JSON.parse(response);if($("html, body").css("cursor","auto"),$(".modal-footer").children("img").css("visibility","hidden"),1==data_response.error)Modal.create({title:datatables_lang_messages.notification_info,body:data_response.message+" .Please reload the page!",show:!0,removeOnClose:!0});else{var extension=data_response.data;extension.time_content?$("#extension-time-content").html(extension.time_content):$("#extension-time-content").html(time_content),document.getElementById("extension-extend-deadline").value=data_response.data.time_iso_8601.slice(0,16),$("#extension-reason-select").val(extension.pre_defined_reason),$("#extension-allocatabletype").val(extension.allocatabletype),$("#extension-allocatableid").val(extension.allocatableid),$("#extension-courseworkid").val(extension.courseworkid),$("#extension-id").val(extension.id),$("#id_extra_information").val(extension.text),$("#id_extra_information").prop("disabled",!1),$("#extension-extend-deadline").prop("disabled",!1),$("#extension-reason-select").prop("disabled",!1),save_extension_form_data()}},error:function(){$("html, body").css("cursor","auto"),change__status_extension_submit_button(!1)},complete:function(){$("html, body").css("cursor","auto"),change__status_extension_submit_button(!1)}})}($(this).attr("data-name"),JSON.parse($(this).attr("data-params")),JSON.parse($(this).attr("data-time")),$(this).closest("tr").attr("id")),$("#modal-ajax").modal("show")})),$(".modal-footer").on("click","#extension-submit",(function(e){e.preventDefault();var params={};params.allocatabletype=$("#extension-allocatabletype").val(),params.allocatableid=$("#extension-allocatableid").val(),params.courseworkid=$("#extension-courseworkid").val(),params.id=$("#extension-id").val(),params.extended_deadline=$("#extension-extend-deadline").val(),params.editor=$("#extension-time-content").html(),params.text=$("#id_extra_information").val(),params.submissionid=$("#extension-submissionid").val(),params.pre_defined_reason=$("#extension-reason-select").val(),params.requesttype="submit";var current_rowid=$("#button-id").val(),url=datatables_lang_messages.url_root;$.ajax({type:"POST",url:url+"/mod/coursework/actions/ajax/deadline_extension/submit.php",data:params,beforeSend:function(){$("html, body").css("cursor","wait"),$(".modal-footer").children("img").css("visibility","visible")},success:function(response){var data_response=JSON.parse(response);$("html, body").css("cursor","auto"),$(".modal-footer").children("img").css("visibility","hidden"),1==data_response.error?Modal.create({title:str.getString("notification_info","mod_coursework"),body:data_response.messages,show:!0,removeOnClose:!0}):(!function(rowid,response){const row=$("#"+rowid),datastatus=row.attr("data-status");datastatus&&datastatus.length>0?row.attr("data-status",datastatus+",extension-granted"):row.attr("data-status","extension-granted");str.getString("due","mod_coursework").then((function(duestr){const deadline=duestr+": "+response.data.extended_deadline_formatted;row.find(".extensiongranted-container").removeClass("d-none").end().find(".actions-extension-date-container").addClass("d-block").removeClass("d-none").end().find(".extensiongranteddate, .actions-extension-date").html(deadline).end().find(".duedate-container").addClass("d-none").end().find(".new_deadline_extension").attr("data-params",JSON.stringify(response.data)).removeClass("new_deadline_extension").addClass("edit_deadline_extension")})).catch((function(error){window.console.log("Error getting string:",error)}))}(current_rowid,data_response),change__status_extension_submit_button(!0),save_extension_form_data(),Modal.create({title:str.getString("notification_info","mod_coursework"),body:str.getString("alert_extension_save_successful","mod_coursework"),show:!0,removeOnClose:!0}))},error:function(){$("html, body").css("cursor","auto")},complete:function(){$("html, body").css("cursor","auto")}})})),$("#modal-ajax").on("hide.bs.modal",(function(){return!extension_form_change||(Notification.confirm(str.getString("notification_leave_form_title","mod_coursework"),str.getString("notification_leave_form_message","mod_coursework"),str.getString("notification_yes_label","mod_coursework"),str.getString("notification_no_label","mod_coursework"),(function(){save_extension_form_data(),$("#modal-ajax").modal("hide")})),!1)})),$("#form-extension :input").change((function(){extension_form_change=!0,change__status_extension_submit_button(!1)}))}))}}}));

//# sourceMappingURL=coursework_edit.min.js.map