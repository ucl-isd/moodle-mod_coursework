define("mod_coursework/total_mark",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;
/**
   * Total mark calculation module for mod_coursework.
   *
   * @module     mod_coursework/total_mark
   * @copyright  2026 UCL
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
const updateUi=(totalScore,totalMax)=>{const score=+totalScore.toFixed(2),max=+totalMax.toFixed(2),percent=max>0?score/max*100:0,displayPercent=+Math.max(0,Math.min(percent,100)).toFixed(2);document.querySelectorAll('[data-region="total-mark-display"]').forEach((region=>{region.querySelector(".total-score-text").textContent=score.toString(),region.querySelector(".total-max-text").textContent=max.toString(),region.querySelector(".total-percent").textContent=displayPercent.toString();const bar=region.querySelector(".total-progress-bar");bar&&(bar.style.width=displayPercent+"%",bar.setAttribute("aria-valuenow",score.toString()),bar.setAttribute("aria-valuemax",max.toString()))}))},calculateRubric=()=>{const rubric=document.querySelector(".gradingform_rubric");if(!rubric)return;let runningTotal=0,runningMax=0;rubric.querySelectorAll(".criterion").forEach((row=>{const selected=row.querySelector(".level.checked .scorevalue");selected&&(runningTotal+=parseFloat(selected.textContent)||0);let rowMax=0;row.querySelectorAll(".scorevalue").forEach((span=>{const val=parseFloat(span.textContent)||0;val>rowMax&&(rowMax=val)})),runningMax+=rowMax})),updateUi(runningTotal,runningMax)},calculateGuide=()=>{const guide=document.querySelector(".gradingform_guide");if(!guide)return;let runningTotal=0,runningMax=0;guide.querySelectorAll('.score input:not(.input-percent)[type="number"]').forEach((input=>{const val=parseFloat(input.value),max=parseFloat(input.getAttribute("max"));isNaN(val)||(runningTotal+=Math.min(val,max)),isNaN(max)||(runningMax+=max)})),updateUi(runningTotal,runningMax)};_exports.init=()=>{const run=()=>{setTimeout((()=>{(()=>{const rubric=document.querySelector(".gradingform_rubric"),guide=document.querySelector(".gradingform_guide");rubric&&(new MutationObserver(calculateRubric).observe(rubric,{attributes:!0,subtree:!0,attributeFilter:["class"]}),calculateRubric());guide&&(document.addEventListener("input",(e=>{e.target.closest(".gradingform_guide .score")&&calculateGuide()})),calculateGuide())})()}),50)};"complete"===document.readyState?run():window.addEventListener("load",run)}}));

//# sourceMappingURL=total_mark.min.js.map