{"version":3,"file":"coursework_edit.min.js","sources":["../src/coursework_edit.js"],"sourcesContent":["define('mod_coursework/coursework_edit',\n    ['jquery', 'core/notification', 'core/modal', 'core/str'], function($, Notification, Modal, str) {\n    return {\n        init: function() {\n            var now = new Date();\n\n            $(document).ready(function() {\n                // Prepare Message\n                const messages = $('#datatables_lang_messages');\n                var datatables_lang_messages = messages.length ? JSON.parse(messages.attr('data-lang')) : [];\n\n                /**\n                 * Personal Deadline\n                 */\n                $('.datatabletest').on('click', '.edit_personal_deadline',function(e) {\n                    e.preventDefault();\n                    var parent = $(this).closest('.personal_deadline_cell');\n                    parent.children('.show_personal_dealine').addClass('display-none');\n                    var change_form = parent.children('.show_edit_personal_dealine');\n                    var data_get = $(this).attr('data-get');\n                    var data_time = $(this).attr('data-time-iso-8601');\n                    if (change_form.html().length === 1) {\n                        var form = '<input type=\"datetime-local\" step=\"300\" class=\"input-personal-deadline\"' +\n                            ' value=\"' + data_time + '\">';\n                        form += '<div class=\"personal_deadline_button\"><a href=\"/\" class=\"approve-personal-deadline\" data-get=';\n                        form += data_get;\n                        form += '><i class=\"fa fa-check\" aria-hidden=\"true\"></i></a>';\n                        form += '<a href=\"/\" class=\"cancel-personal-deadline\"><i class=\"fa fa-times\" aria-hidden=\"true\">' +\n                            '</i></a></div>';\n                        $(change_form).html(form);\n                    }\n                    $(change_form).removeClass('display-none');\n                });\n\n                $('.datatabletest').on('click', '.cancel-personal-deadline', function(e) {\n                    e.preventDefault();\n                    $(this).closest('.show_edit_personal_dealine').addClass('display-none');\n                    $(this).closest('.personal_deadline_cell').children('.show_personal_dealine').removeClass('display-none');\n                });\n\n                $('.datatabletest').on('click', '.approve-personal-deadline', function(e) {\n                    e.preventDefault();\n                    var deadline = $(this);\n                    var data_get = $(deadline).attr('data-get');\n                    var value = $(deadline).closest('.show_edit_personal_dealine').children('.input-personal-deadline').val();\n                    var input_date = new Date(value);\n                    if (input_date <= Date.parse(now)) {\n                        Modal.create({\n                            title: datatables_lang_messages.notification_info,\n                            body: datatables_lang_messages.alert_validate_deadline.replace(/\\_/g, ' '),\n                            show: true,\n                            removeOnClose: true,\n                        });\n                    }\n\n                    var url = datatables_lang_messages.url_root + \"/mod/coursework/actions/personal_deadline.php\";\n                    var param = JSON.parse(data_get);\n                    param.personal_deadline_time = value;\n\n                    $.ajax({\n                        type: \"POST\",\n                        url: url,\n                        data: param,\n                        beforeSend: function() {\n                            $('html, body').css(\"cursor\", \"wait\");\n                            $(self).prev('img').css('visibility', 'visible');\n                        },\n                        success: function(response, table_obj_list) {\n                            $('html, body').css(\"cursor\", \"auto\");\n                            var data_response = JSON.parse(response);\n                            if (data_response.error === 1) {\n                                Modal.create({\n                                    title: datatables_lang_messages.notification_info,\n                                    body: data_response.message,\n                                    show: true,\n                                    removeOnClose: true,\n                                });\n                            } else {\n                                var parent = $(deadline).closest('.personal_deadline_cell');\n                                $(parent).attr('data-order', data_response.timestamp);\n                                var table = table_obj_list[Object.keys(table_obj_list)[0]];\n                                table.row('#' + $(parent).closest('tr').attr('id')).invalidate();\n\n                                $(parent).children('.show_personal_dealine').children('.content_personal_deadline').\n                                html(data_response.time);\n                                $(parent).children('.show_edit_personal_dealine').addClass('display-none');\n                                $(parent).children('.show_personal_dealine').removeClass('display-none');\n                                Modal.create({\n                                    title: datatables_lang_messages.notification_info,\n                                    body: datatables_lang_messages.alert_personaldeadline_save_successful.replace(/\\_/g, ' '),\n                                    show: true,\n                                    removeOnClose: true,\n                                });\n                            }\n                        },\n                        error: function() {\n                            $('html, body').css(\"cursor\", \"auto\");\n                        },\n                        complete: function() {\n                            $('html, body').css(\"cursor\", \"auto\");\n                        }\n                    });\n\n                });\n\n                // Submission finalisation\n                $('.coursework-actions').on('click', '.submission-finalisation', function(e) {\n                    e.preventDefault();\n                    const action = $(this).attr('data-action');\n                    const studentname = $(this).attr('data-student');\n                    const url = $(this).attr('href');\n                    Notification.confirm(\n                        str.getString('notification_confirm_label', 'mod_coursework'),\n                        str.getString('confirm_finalise', 'mod_coursework', {'action': action, 'studentname': studentname}),\n                        str.getString('notification_yes_label', 'mod_coursework'),\n                        str.getString('notification_no_label', 'mod_coursework'),\n                        function() {\n                            // Redirect to URL.\n                            window.location.href = url;\n                        }\n                    );\n                });\n            });\n        }\n    };\n});\n"],"names":["define","$","Notification","Modal","str","init","now","Date","document","ready","messages","datatables_lang_messages","length","JSON","parse","attr","on","e","preventDefault","parent","this","closest","children","addClass","change_form","data_get","data_time","html","form","removeClass","deadline","value","val","create","title","notification_info","body","alert_validate_deadline","replace","show","removeOnClose","url","url_root","param","personal_deadline_time","ajax","type","data","beforeSend","css","self","prev","success","response","table_obj_list","data_response","error","message","timestamp","Object","keys","row","invalidate","time","alert_personaldeadline_save_successful","complete","action","studentname","confirm","getString","window","location","href"],"mappings":"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"}