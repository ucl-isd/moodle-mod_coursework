{"version":3,"file":"coursework_edit.min.js","sources":["../src/coursework_edit.js"],"sourcesContent":["define('mod_coursework/coursework_edit',\n    ['jquery', 'core/notification', 'core/modal', 'core/str'], function($, Notification, Modal, str) {\n    return {\n        init: function() {\n            var now = new Date();\n\n            $(document).ready(function() {\n                // Prepare Message\n                var datatables_lang_messages = JSON.parse($('#datatables_lang_messages').attr('data-lang'));\n\n                /**\n                 * Personal Deadline\n                 */\n                $('.datatabletest').on('click', '.edit_personal_deadline',function(e) {\n                    e.preventDefault();\n                    var parent = $(this).closest('.personal_deadline_cell');\n                    parent.children('.show_personal_dealine').addClass('display-none');\n                    var change_form = parent.children('.show_edit_personal_dealine');\n                    var data_get = $(this).attr('data-get');\n                    var data_time = $(this).attr('data-time-iso-8601');\n                    if (change_form.html().length === 1) {\n                        var form = '<input type=\"datetime-local\" step=\"300\" class=\"input-personal-deadline\"' +\n                            ' value=\"' + data_time + '\">';\n                        form += '<div class=\"personal_deadline_button\"><a href=\"/\" class=\"approve-personal-deadline\" data-get=';\n                        form += data_get;\n                        form += '><i class=\"fa fa-check\" aria-hidden=\"true\"></i></a>';\n                        form += '<a href=\"/\" class=\"cancel-personal-deadline\"><i class=\"fa fa-times\" aria-hidden=\"true\">' +\n                            '</i></a></div>';\n                        $(change_form).html(form);\n                    }\n                    $(change_form).removeClass('display-none');\n                });\n\n                $('.datatabletest').on('click', '.cancel-personal-deadline', function(e) {\n                    e.preventDefault();\n                    $(this).closest('.show_edit_personal_dealine').addClass('display-none');\n                    $(this).closest('.personal_deadline_cell').children('.show_personal_dealine').removeClass('display-none');\n                });\n\n                $('.datatabletest').on('click', '.approve-personal-deadline', function(e) {\n                    e.preventDefault();\n                    var deadline = $(this);\n                    var data_get = $(deadline).attr('data-get');\n                    var value = $(deadline).closest('.show_edit_personal_dealine').children('.input-personal-deadline').val();\n                    var input_date = new Date(value);\n                    if (input_date <= Date.parse(now)) {\n                        Modal.create({\n                            title: datatables_lang_messages.notification_info,\n                            body: datatables_lang_messages.alert_validate_deadline.replace(/\\_/g, ' '),\n                            show: true,\n                            removeOnClose: true,\n                        });\n                    }\n\n                    var url = datatables_lang_messages.url_root + \"/mod/coursework/actions/personal_deadline.php\";\n                    var param = JSON.parse(data_get);\n                    param.personal_deadline_time = value;\n\n                    $.ajax({\n                        type: \"POST\",\n                        url: url,\n                        data: param,\n                        beforeSend: function() {\n                            $('html, body').css(\"cursor\", \"wait\");\n                            $(self).prev('img').css('visibility', 'visible');\n                        },\n                        success: function(response, table_obj_list) {\n                            $('html, body').css(\"cursor\", \"auto\");\n                            var data_response = JSON.parse(response);\n                            if (data_response.error === 1) {\n                                Modal.create({\n                                    title: datatables_lang_messages.notification_info,\n                                    body: data_response.message,\n                                    show: true,\n                                    removeOnClose: true,\n                                });\n                            } else {\n                                var parent = $(deadline).closest('.personal_deadline_cell');\n                                $(parent).attr('data-order', data_response.timestamp);\n                                var table = table_obj_list[Object.keys(table_obj_list)[0]];\n                                table.row('#' + $(parent).closest('tr').attr('id')).invalidate();\n\n                                $(parent).children('.show_personal_dealine').children('.content_personal_deadline').\n                                html(data_response.time);\n                                $(parent).children('.show_edit_personal_dealine').addClass('display-none');\n                                $(parent).children('.show_personal_dealine').removeClass('display-none');\n                                Modal.create({\n                                    title: datatables_lang_messages.notification_info,\n                                    body: datatables_lang_messages.alert_personaldeadline_save_successful.replace(/\\_/g, ' '),\n                                    show: true,\n                                    removeOnClose: true,\n                                });\n                            }\n                        },\n                        error: function() {\n                            $('html, body').css(\"cursor\", \"auto\");\n                        },\n                        complete: function() {\n                            $('html, body').css(\"cursor\", \"auto\");\n                        }\n                    });\n\n                });\n\n                // Submission finalisation\n                $('.coursework-actions').on('click', '.submission-finalisation', function(e) {\n                    e.preventDefault();\n                    const action = $(this).attr('data-action');\n                    const studentname = $(this).attr('data-student');\n                    const url = $(this).attr('href');\n                    Notification.confirm(\n                        str.getString('notification_confirm_label', 'mod_coursework'),\n                        str.getString('confirm_finalise', 'mod_coursework', {'action': action, 'studentname': studentname}),\n                        str.getString('notification_yes_label', 'mod_coursework'),\n                        str.getString('notification_no_label', 'mod_coursework'),\n                        function() {\n                            // Redirect to URL.\n                            window.location.href = url;\n                        }\n                    );\n                });\n            });\n        }\n    };\n});\n"],"names":["define","$","Notification","Modal","str","init","now","Date","document","ready","datatables_lang_messages","JSON","parse","attr","on","e","preventDefault","parent","this","closest","children","addClass","change_form","data_get","data_time","html","length","form","removeClass","deadline","value","val","create","title","notification_info","body","alert_validate_deadline","replace","show","removeOnClose","url","url_root","param","personal_deadline_time","ajax","type","data","beforeSend","css","self","prev","success","response","table_obj_list","data_response","error","message","timestamp","Object","keys","row","invalidate","time","alert_personaldeadline_save_successful","complete","action","studentname","confirm","getString","window","location","href"],"mappings":"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"}