{"version":3,"file":"total_mark.min.js","sources":["../src/total_mark.js"],"sourcesContent":["/**\n * Total mark calculation module for mod_coursework.\n *\n * @module     mod_coursework/total_mark\n * @copyright  2026 UCL\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * Update the UI elements.\n *\n * @param {Number} total_score The current total score.\n * @param {Number} total_max The maximum possible score.\n */\nconst update_ui = (total_score, total_max) => {\n    const score = +total_score.toFixed(2);\n    const max = +total_max.toFixed(2);\n    const percent = max > 0 ? (score / max) * 100 : 0;\n    const display_percent = +Math.max(0, Math.min(percent, 100)).toFixed(2);\n\n    document.querySelectorAll('[data-region=\"total-mark-display\"]').forEach(region => {\n        // Update the text spans.\n        region.querySelector('.total-score-text').textContent = score.toString();\n        region.querySelector('.total-max-text').textContent = max.toString();\n        region.querySelector('.total-percent').textContent = display_percent.toString();\n\n        // Update the progress bar.\n        const bar = region.querySelector('.total-progress-bar');\n        if (bar) {\n            bar.style.width = display_percent + '%';\n            bar.setAttribute('aria-valuenow', score.toString());\n            bar.setAttribute('aria-valuemax', max.toString());\n        }\n    });\n};\n\n/**\n * Calculate totals for Rubric.\n */\nconst calculate_rubric = () => {\n    const rubric = document.querySelector('.gradingform_rubric');\n    if (!rubric) {\n        return;\n    }\n\n    let running_total = 0;\n    let running_max = 0;\n\n    rubric.querySelectorAll('.criterion').forEach(row => {\n        const selected = row.querySelector('.level.checked .scorevalue');\n        if (selected) {\n            running_total += parseFloat(selected.textContent) || 0;\n        }\n\n        let row_max = 0;\n        row.querySelectorAll('.scorevalue').forEach(span => {\n            const val = parseFloat(span.textContent) || 0;\n            if (val > row_max) {\n                row_max = val;\n            }\n        });\n        running_max += row_max;\n    });\n\n    update_ui(running_total, running_max);\n};\n\n/**\n * Calculate totals for Marking Guide.\n */\nconst calculate_guide = () => {\n    const guide = document.querySelector('.gradingform_guide');\n    if (!guide) {\n        return;\n    }\n\n    let running_total = 0;\n    let running_max = 0;\n\n    guide.querySelectorAll('.score input[type=\"number\"]').forEach(input => {\n        const val = parseFloat(input.value);\n        const max = parseFloat(input.getAttribute('max'));\n        if (!isNaN(val)) {\n            running_total += val;\n        }\n        if (!isNaN(max)) {\n            running_max += max;\n        }\n    });\n\n    update_ui(running_total, running_max);\n};\n\n/**\n * Initialize the grading tracker listeners.\n */\nconst init_grading_tracker = () => {\n    const rubric = document.querySelector('.gradingform_rubric');\n    const guide = document.querySelector('.gradingform_guide');\n\n    if (rubric) {\n        const observer = new MutationObserver(calculate_rubric);\n        observer.observe(rubric, {\n            attributes: true,\n            subtree: true,\n            attributeFilter: ['class']\n        });\n        calculate_rubric();\n    }\n\n    if (guide) {\n        document.addEventListener('input', (e) => {\n            if (e.target.closest('.gradingform_guide .score')) {\n                calculate_guide();\n            }\n        });\n        calculate_guide();\n    }\n};\n\n/**\n * init.\n */\nexport const init = () => {\n    const run = () => {\n        // A tiny 50ms delay to let the DOM settle.\n        setTimeout(() => {\n            init_grading_tracker();\n        }, 50);\n    };\n\n    if (document.readyState === 'complete') {\n        run();\n    } else {\n        window.addEventListener('load', run);\n    }\n};"],"names":["update_ui","total_score","total_max","score","toFixed","max","percent","display_percent","Math","min","document","querySelectorAll","forEach","region","querySelector","textContent","toString","bar","style","width","setAttribute","calculate_rubric","rubric","running_total","running_max","row","selected","parseFloat","row_max","span","val","calculate_guide","guide","input","value","getAttribute","isNaN","run","setTimeout","MutationObserver","observe","attributes","subtree","attributeFilter","addEventListener","e","target","closest","init_grading_tracker","readyState","window"],"mappings":";;;;;;;;MAcMA,UAAY,CAACC,YAAaC,mBACtBC,OAASF,YAAYG,QAAQ,GAC7BC,KAAOH,UAAUE,QAAQ,GACzBE,QAAUD,IAAM,EAAKF,MAAQE,IAAO,IAAM,EAC1CE,iBAAmBC,KAAKH,IAAI,EAAGG,KAAKC,IAAIH,QAAS,MAAMF,QAAQ,GAErEM,SAASC,iBAAiB,sCAAsCC,SAAQC,SAEpEA,OAAOC,cAAc,qBAAqBC,YAAcZ,MAAMa,WAC9DH,OAAOC,cAAc,mBAAmBC,YAAcV,IAAIW,WAC1DH,OAAOC,cAAc,kBAAkBC,YAAcR,gBAAgBS,iBAG/DC,IAAMJ,OAAOC,cAAc,uBAC7BG,MACAA,IAAIC,MAAMC,MAAQZ,gBAAkB,IACpCU,IAAIG,aAAa,gBAAiBjB,MAAMa,YACxCC,IAAIG,aAAa,gBAAiBf,IAAIW,iBAQ5CK,iBAAmB,WACfC,OAASZ,SAASI,cAAc,2BACjCQ,kBAIDC,cAAgB,EAChBC,YAAc,EAElBF,OAAOX,iBAAiB,cAAcC,SAAQa,YACpCC,SAAWD,IAAIX,cAAc,8BAC/BY,WACAH,eAAiBI,WAAWD,SAASX,cAAgB,OAGrDa,QAAU,EACdH,IAAId,iBAAiB,eAAeC,SAAQiB,aAClCC,IAAMH,WAAWE,KAAKd,cAAgB,EACxCe,IAAMF,UACNA,QAAUE,QAGlBN,aAAeI,WAGnB5B,UAAUuB,cAAeC,cAMvBO,gBAAkB,WACdC,MAAQtB,SAASI,cAAc,0BAChCkB,iBAIDT,cAAgB,EAChBC,YAAc,EAElBQ,MAAMrB,iBAAiB,+BAA+BC,SAAQqB,cACpDH,IAAMH,WAAWM,MAAMC,OACvB7B,IAAMsB,WAAWM,MAAME,aAAa,QACrCC,MAAMN,OACPP,eAAiBO,KAEhBM,MAAM/B,OACPmB,aAAenB,QAIvBL,UAAUuB,cAAeC,4BAiCT,WACVa,IAAM,KAERC,YAAW,KA9BU,YACnBhB,OAASZ,SAASI,cAAc,uBAChCkB,MAAQtB,SAASI,cAAc,sBAEjCQ,SACiB,IAAIiB,iBAAiBlB,kBAC7BmB,QAAQlB,OAAQ,CACrBmB,YAAY,EACZC,SAAS,EACTC,gBAAiB,CAAC,WAEtBtB,oBAGAW,QACAtB,SAASkC,iBAAiB,SAAUC,IAC5BA,EAAEC,OAAOC,QAAQ,8BACjBhB,qBAGRA,oBAWIiB,KACD,KAGqB,aAAxBtC,SAASuC,WACTZ,MAEAa,OAAON,iBAAiB,OAAQP"}