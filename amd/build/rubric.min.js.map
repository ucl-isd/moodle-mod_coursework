{"version":3,"file":"rubric.min.js","sources":["../src/rubric.js"],"sourcesContent":["/**\n * Rubric labeling and interaction logic for mod_coursework.\n *\n * @module     mod_coursework/rubric\n * @copyright  2026 UCL\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {getString} from 'core/str';\n\n/**\n * Initialize the rubric enhancements.\n */\nexport const init = async() => {\n    const rubricContainer = document.querySelector('.gradingform_rubric');\n    if (!rubricContainer) {\n        return;\n    }\n\n    // Radio button fix.\n    rubricContainer.addEventListener('click', (e) => {\n        const cell = e.target.closest('.level');\n        if (!cell) {\n            return;\n        }\n\n        const radio = cell.querySelector('input[type=\"radio\"]');\n        if (!radio) {\n            return;\n        }\n\n        // Stop Moodle core JS from interfering.\n        e.stopPropagation();\n\n        if (e.target !== radio) {\n            radio.checked = true;\n        }\n\n        // Update visual states.\n        const row = cell.closest('tr');\n        row.querySelectorAll('.level').forEach((l) => {\n            l.classList.remove('checked', 'currentchecked');\n            l.setAttribute('aria-checked', 'false');\n        });\n\n        cell.classList.add('checked', 'currentchecked');\n        cell.setAttribute('aria-checked', 'true');\n\n        // Trigger change for Moodle's calculation logic.\n        radio.dispatchEvent(new Event('change', {bubbles: true}));\n    }, true);\n\n    // Feedback labeling logic.\n    try {\n        const feedbackPrefix = await getString('feedbackfor', 'mod_coursework');\n        const remarkCells = rubricContainer.querySelectorAll('td.remark');\n\n        remarkCells.forEach(cell => {\n            const textarea = cell.querySelector('textarea');\n            const parentRow = cell.closest('tr');\n            const descriptionCell = parentRow ? parentRow.querySelector('td.description') : null;\n\n            if (textarea && descriptionCell) {\n                const tempDescription = descriptionCell.cloneNode(true);\n                const criterionName = tempDescription.textContent.trim();\n\n                const feedbackLabel = document.createElement('label');\n                feedbackLabel.textContent = `${feedbackPrefix} ${criterionName}`;\n\n                if (textarea.id) {\n                    feedbackLabel.setAttribute('for', textarea.id);\n                }\n\n                cell.insertBefore(feedbackLabel, textarea);\n            }\n        });\n    } catch (error) {\n        // eslint-disable-next-line no-console\n        console.error(\"Catch from rubric.js:\", error);\n    }\n};"],"names":["async","rubricContainer","document","querySelector","addEventListener","e","cell","target","closest","radio","stopPropagation","checked","querySelectorAll","forEach","l","classList","remove","setAttribute","add","dispatchEvent","Event","bubbles","feedbackPrefix","textarea","parentRow","descriptionCell","criterionName","cloneNode","textContent","trim","feedbackLabel","createElement","id","insertBefore","error","console"],"mappings":"0KAaoBA,gBACVC,gBAAkBC,SAASC,cAAc,0BAC1CF,iBAKLA,gBAAgBG,iBAAiB,SAAUC,UACjCC,KAAOD,EAAEE,OAAOC,QAAQ,cACzBF,kBAICG,MAAQH,KAAKH,cAAc,2BAC5BM,aAKLJ,EAAEK,kBAEEL,EAAEE,SAAWE,QACbA,MAAME,SAAU,GAIRL,KAAKE,QAAQ,MACrBI,iBAAiB,UAAUC,SAASC,IACpCA,EAAEC,UAAUC,OAAO,UAAW,kBAC9BF,EAAEG,aAAa,eAAgB,YAGnCX,KAAKS,UAAUG,IAAI,UAAW,kBAC9BZ,KAAKW,aAAa,eAAgB,QAGlCR,MAAMU,cAAc,IAAIC,MAAM,SAAU,CAACC,SAAS,QACnD,aAIOC,qBAAuB,kBAAU,cAAe,kBAClCrB,gBAAgBW,iBAAiB,aAEzCC,SAAQP,aACViB,SAAWjB,KAAKH,cAAc,YAC9BqB,UAAYlB,KAAKE,QAAQ,MACzBiB,gBAAkBD,UAAYA,UAAUrB,cAAc,kBAAoB,QAE5EoB,UAAYE,gBAAiB,OAEvBC,cADkBD,gBAAgBE,WAAU,GACZC,YAAYC,OAE5CC,cAAgB5B,SAAS6B,cAAc,SAC7CD,cAAcF,YAAe,GAAEN,kBAAkBI,gBAE7CH,SAASS,IACTF,cAAcb,aAAa,MAAOM,SAASS,IAG/C1B,KAAK2B,aAAaH,cAAeP,cAG3C,MAAOW,OAELC,QAAQD,MAAM,wBAAyBA"}