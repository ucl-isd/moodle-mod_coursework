{{!
    This file is part of Moodle - http://moodle.org/
    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}

<div {{#showpdf}} class="full-width" {{/showpdf}}>
    <div class="container-fluid">
        <div class="row">

            {{! Marking. }}
            <div class="col animate-enter">
                <div class="container">
                    {{! When not a PDF, show submissions metadata as header. }}
                    {{^showpdf}}
                        {{> mod_coursework/submissions/tr/submissions }}
                    {{/showpdf}}

                    <h3>Marking</h3>
                    {{#previousfeedback}}
                        {{{.}}}
                        <h4 class="pt-3">{{#str}} agreefeedback, mod_coursework {{/str}}</h4>
                    {{/previousfeedback}}

                    <div id="coursework-markingform">
                        {{{marking}}}
                    </div>
                </div>
            </div>

            {{! Pdf. }}
            {{#showpdf}}
            <div class="col-md-6">
                {{> mod_coursework/marking/pdf }}
            </div>
            {{/showpdf}}
        </div>
    </div>
</div>

{{! js fixing forms. }}
<script>
(function() {
    window.addEventListener('load', function() {
        const root = document.getElementById('coursework-markingform');
        if (!root) return;

        const score_cells = root.querySelectorAll('td.score');

        score_cells.forEach(cell => {
            const input = cell.querySelector('input');
            const max_div = cell.querySelector('div');

            if (input && max_div) {
                const max_score = max_div.textContent.replace(/[^0-9.]/g, '');

                // 1. Add required attribute.
                input.setAttribute('required', 'required');

                // 2. Update HTML attributes.
                input.setAttribute('type', 'number');
                input.setAttribute('min', '0');
                if (max_score) {
                    input.setAttribute('max', max_score);
                }
                input.setAttribute('step', 'any');

                // 3. Create and insert label.
                const label = document.createElement('label');
                label.textContent = `{{#str}} mark, mod_coursework {{/str}} (0â€“${max_score})`;

                if (input.id) {
                    label.setAttribute('for', input.id);
                }

                cell.insertBefore(label, cell.firstChild);

                // 4. Remove overhanging div.
                max_div.remove();
            }
        });
    });
})();
</script>